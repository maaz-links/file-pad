import React, { useState, useRef } from 'react';
import ReactQuill from 'react-quill';
import 'react-quill/dist/quill.snow.css';

export default function Editor({onClick, textValue, setTextValue, setIsTextEmpty}) {
  //const [value, setValue] = useState('');
  const quillRef = useRef(null);
  const editorRef = useRef(null);
  const [isFull, setIsFull] = useState(false)

  const handleTextChange = (value) => { //This is value attrib from quill, not state
    setTextValue(value);
    const textlength = quillRef.current.getEditor().getLength();
    if(textlength > 1){
      setIsTextEmpty(false);
    }
    else{
      setIsTextEmpty(true);
    }
  }

  const modules = {
    toolbar: [
      ['bold', 'italic', 'underline', 'strike'],
      ['code-block', "blockquote"],
      ['link'], //'image'
      [{ 'color': [] }],
      [{ 'list': 'bullet' }],
      //[{ 'align': [] }],
    ],
    history: {
      delay: 500,
      maxStack: 100,
      userOnly: true,
    },
  };

  const handleUndo = () => {
    const quill = quillRef.current.getEditor();
    quill.history.undo();
  };

  const handleRedo = () => {
    const quill = quillRef.current.getEditor();
    quill.history.redo();
  };


  return (
    <div className={`w-100 h-100 ${!isFull ? 'p-0' : 'p-4'}`} ref={editorRef}>
      <ReactQuill
        className="relative"
        ref={quillRef}
        theme="snow"
        modules={modules}
        value={textValue}
        placeholder="Write your anonymous & encrypted note here..."
        onChange={handleTextChange}
      />
      <div className="ql-custom ql-formats position-absolute">
        <button className="p-0 border-0 ql-custom-btn" onClick={handleUndo} title="Undo">
          <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8.53131 0.375C12.9255 0.375 16.4873 3.93684 16.4873 8.331C16.4873 12.7252 12.9255 16.287 8.53131 16.287C7.48634 16.2883 6.45141 16.083 5.48601 15.6831C4.5206 15.2831 3.64374 14.6964 2.90581 13.9565C2.7977 13.8405 2.73885 13.687 2.74165 13.5285C2.74445 13.3699 2.80867 13.2187 2.9208 13.1065C3.03293 12.9944 3.18421 12.9302 3.34276 12.9274C3.50131 12.9246 3.65475 12.9834 3.77077 13.0915C4.55361 13.8743 5.51741 14.4519 6.57679 14.7732C7.63618 15.0945 8.75846 15.1496 9.84422 14.9336C10.93 14.7176 11.9457 14.2372 12.8015 13.5349C13.6572 12.8326 14.3266 11.9301 14.7502 10.9073C15.1739 9.88454 15.3388 8.77307 15.2303 7.67136C15.1218 6.56965 14.7433 5.51169 14.1283 4.59119C13.5134 3.67068 12.6809 2.91605 11.7046 2.39413C10.7283 1.8722 9.63835 1.5991 8.53131 1.599C6.44561 1.599 4.92296 2.55209 3.49822 3.91073L5.06331 5.475C5.06331 5.81282 4.78913 6.087 4.45131 6.087H1.18731C1.025 6.087 0.869334 6.02252 0.754562 5.90775C0.63979 5.79297 0.575312 5.63731 0.575312 5.475V2.211C0.575312 2.04869 0.63979 1.89302 0.754562 1.77825C0.869334 1.66348 1.025 1.599 1.18731 1.599L2.63163 3.04332C4.18203 1.56228 6.00579 0.375 8.53131 0.375Z" fill="#E3DFDF" />
          </svg>
        </button>
        <button className="p-0 border-0 ql-custom-btn" onClick={handleRedo} title="Redo">
          <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8.37201 0.375C3.97785 0.375 0.416016 3.93684 0.416016 8.331C0.416016 12.7252 3.97785 16.287 8.37201 16.287C9.41698 16.2883 10.4519 16.083 11.4173 15.6831C12.3827 15.2831 13.2596 14.6964 13.9975 13.9565C14.1056 13.8405 14.1645 13.687 14.1617 13.5285C14.1589 13.3699 14.0946 13.2187 13.9825 13.1065C13.8704 12.9944 13.7191 12.9302 13.5606 12.9274C13.402 12.9246 13.2486 12.9834 13.1326 13.0915C12.3497 13.8743 11.3859 14.4519 10.3265 14.7732C9.26714 15.0945 8.14486 15.1496 7.0591 14.9336C5.97334 14.7176 4.9576 14.2372 4.10185 13.5349C3.2461 12.8326 2.57675 11.9301 2.15309 10.9073C1.72943 9.88454 1.56454 8.77307 1.67301 7.67136C1.78149 6.56965 2.15998 5.51169 2.77497 4.59119C3.38996 3.67068 4.22247 2.91605 5.19876 2.39413C6.17504 1.8722 7.26497 1.5991 8.37201 1.599C10.4577 1.599 11.9804 2.55209 13.4051 3.91073L11.84 5.475C11.84 5.81282 12.1142 6.087 12.452 6.087H15.716C15.8783 6.087 16.034 6.02252 16.1488 5.90775C16.2635 5.79297 16.328 5.63731 16.328 5.475V2.211C16.328 2.04869 16.2635 1.89302 16.1488 1.77825C16.034 1.66348 15.8783 1.599 15.716 1.599L14.2717 3.04332C12.7213 1.56228 10.8975 0.375 8.37201 0.375Z" fill="#E3DFDF" />
          </svg>
        </button>
        <button className="p-0 border-0 ql-custom-btn me-0" onClick={onClick} title="Fullscreen">
          <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18.7269 0.671875C19.7819 0.671875 20.7937 1.09098 21.5397 1.837C22.2857 2.58302 22.7049 3.59484 22.7049 4.64987V8.32187C22.7049 8.56534 22.6081 8.79884 22.436 8.971C22.2638 9.14316 22.0303 9.23987 21.7869 9.23987C21.5434 9.23987 21.3099 9.14316 21.1377 8.971C20.9656 8.79884 20.8689 8.56534 20.8689 8.32187V4.64987C20.8689 4.08178 20.6432 3.53696 20.2415 3.13525C19.8398 2.73355 19.2949 2.50787 18.7269 2.50787H15.0549C14.8114 2.50787 14.5779 2.41116 14.4057 2.239C14.2336 2.06684 14.1369 1.83334 14.1369 1.58987C14.1369 1.34641 14.2336 1.11291 14.4057 0.940751C14.5779 0.768592 14.8114 0.671875 15.0549 0.671875H18.7269ZM4.65085 0.671875C3.59582 0.671875 2.584 1.09098 1.83798 1.837C1.09196 2.58302 0.672852 3.59484 0.672852 4.64987V8.32187C0.672852 8.56534 0.769569 8.79884 0.941727 8.971C1.11389 9.14316 1.34738 9.23987 1.59085 9.23987C1.83432 9.23987 2.06782 9.14316 2.23998 8.971C2.41213 8.79884 2.50885 8.56534 2.50885 8.32187V4.64987C2.50885 3.46749 3.46847 2.50787 4.65085 2.50787H8.32285C8.56632 2.50787 8.79982 2.41116 8.97198 2.239C9.14413 2.06684 9.24085 1.83334 9.24085 1.58987C9.24085 1.34641 9.14413 1.11291 8.97198 0.940751C8.79982 0.768592 8.56632 0.671875 8.32285 0.671875H4.65085ZM18.7269 22.7039C19.7819 22.7039 20.7937 22.2848 21.5397 21.5387C22.2857 20.7927 22.7049 19.7809 22.7049 18.7259V15.0539C22.7049 14.8104 22.6081 14.5769 22.436 14.4048C22.2638 14.2326 22.0303 14.1359 21.7869 14.1359C21.5434 14.1359 21.3099 14.2326 21.1377 14.4048C20.9656 14.5769 20.8689 14.8104 20.8689 15.0539V18.7259C20.8689 19.294 20.6432 19.8388 20.2415 20.2405C19.8398 20.6422 19.2949 20.8679 18.7269 20.8679H15.0549C14.8114 20.8679 14.5779 20.9646 14.4057 21.1367C14.2336 21.3089 14.1369 21.5424 14.1369 21.7859C14.1369 22.0293 14.2336 22.2628 14.4057 22.435C14.5779 22.6072 14.8114 22.7039 15.0549 22.7039H18.7269ZM0.672852 18.7259C0.672852 19.7809 1.09196 20.7927 1.83798 21.5387C2.584 22.2848 3.59582 22.7039 4.65085 22.7039H8.32285C8.56632 22.7039 8.79982 22.6072 8.97198 22.435C9.14413 22.2628 9.24085 22.0293 9.24085 21.7859C9.24085 21.5424 9.14413 21.3089 8.97198 21.1367C8.79982 20.9646 8.56632 20.8679 8.32285 20.8679H4.65085C4.08276 20.8679 3.53793 20.6422 3.13623 20.2405C2.73453 19.8388 2.50885 19.294 2.50885 18.7259V15.0539C2.50885 14.8104 2.41213 14.5769 2.23998 14.4048C2.06782 14.2326 1.83432 14.1359 1.59085 14.1359C1.34738 14.1359 1.11389 14.2326 0.941727 14.4048C0.769569 14.5769 0.672852 14.8104 0.672852 15.0539V18.7259ZM11.6889 15.3599C12.6627 15.3599 13.5967 14.973 14.2853 14.2844C14.974 13.5957 15.3609 12.6617 15.3609 11.6879C15.3609 10.714 14.974 9.78001 14.2853 9.09138C13.5967 8.40274 12.6627 8.01587 11.6889 8.01587C10.715 8.01587 9.78099 8.40274 9.09235 9.09138C8.40372 9.78001 8.01685 10.714 8.01685 11.6879C8.01685 12.6617 8.40372 13.5957 9.09235 14.2844C9.78099 14.973 10.715 15.3599 11.6889 15.3599ZM11.6889 13.5239C11.2019 13.5239 10.7349 13.3304 10.3906 12.9861C10.0463 12.6418 9.85285 12.1748 9.85285 11.6879C9.85285 11.2009 10.0463 10.7339 10.3906 10.3896C10.7349 10.0453 11.2019 9.85188 11.6889 9.85188C12.1758 9.85188 12.6428 10.0453 12.9871 10.3896C13.3314 10.7339 13.5249 11.2009 13.5249 11.6879C13.5249 12.1748 13.3314 12.6418 12.9871 12.9861C12.6428 13.3304 12.1758 13.5239 11.6889 13.5239ZM6.18085 7.40387C6.50548 7.40387 6.81681 7.27492 7.04635 7.04537C7.27589 6.81583 7.40485 6.5045 7.40485 6.17987C7.40485 5.85525 7.27589 5.54392 7.04635 5.31438C6.81681 5.08483 6.50548 4.95587 6.18085 4.95587C5.85623 4.95587 5.5449 5.08483 5.31535 5.31438C5.08581 5.54392 4.95685 5.85525 4.95685 6.17987C4.95685 6.5045 5.08581 6.81583 5.31535 7.04537C5.5449 7.27492 5.85623 7.40387 6.18085 7.40387Z" fill="#E3DFDF" />
          </svg>
        </button>
      </div>
    </div>
  );
}
